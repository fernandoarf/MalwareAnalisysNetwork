#!/bin/sh
#Script cria Snapshot, executa malware e restaura estado da maquina
if [ $# -eq 0 ] then
	echo "Uso: ./snapshotMalwareAnalisys <arquivo>"
	echo "Usar caminho absoluto em <arquivo>"
fi
if [ $# -gt 2 ] then
	echo "Uso: ./snapshotMalwareAnalisys <arquivo>"
	echo "Usar caminho absoluto em <arquivo>"
file 
#Checa se existe um snapshot criado, senao cria
SNAPSHOTEXISTENCE="$(vboxmanage snapshot MalwareAnalisys	 list)"
if [ $SNAPSHOTEXISTENCE = "This machine does not have any snapshots" ] then
	COMMAND="VBoxManage snapshot "MalwareAnalisys" take "Snapshot 1""
	echo "Executando" $COMMAND
	#Executa o comando
	$($COMMAND)
	echo "Snapshot created"
	printf "\n\n"
else
	echo "Snapshot already exists, continuing"
fi
#Restaura estado
#COMMAND="VBoxManage snapshot "MalwareAnalisys" restore "SnapshotAnteriorExecucao""
#echo "Executando" $COMMAND
#Executa o comando
#$($COMMAND)
#echo "Snapshot restaurado"
#printf "\n\n"
#Executa (terminar)
cuckoo submit --machine cuckoo1 --timeout 600 /home/fernando/Desktop/myproject/media/documents/$1

